# 常用模型性能度量方法

## 回归

### 均方误差

$$\Large E(f;D)=\frac{1}{m}\sum_{i=1}^{m}(f(x_i)-y_i)^2$$

即预测值和实际值的误差平方和的平均值。

对于更一般的数据分布D和概率密度$p(\cdot)$，均方误差可描述为

$\Large E(f;D)=\int_{x\sim D}(f(x)-y)^2p(x)dx$

## 分类

分类结果混淆矩阵

| 真实情况 |  预测结果   |  预测结果   |
| ---- | :-----: | :-----: |
|      |   正例    |   反例    |
| 正例   | TP（真正例） | FN（假反例） |
| 反例   | FP（假正例） | TN（真反例） |

### F-score

#### 二分类

$\LARGE F_\beta =\frac{(1+\beta^2)\times P\times R}{(\beta ^2\times P)+R}$

$P$为查准率（precision），$R$为查全率(recall)，$F_\beta$为查准率和召回率的加权调和平均。$\frac{1}{F_B}=\frac{1}{1+\beta^2}\cdot(\frac{1}{P}+\frac{\beta^2}{R})$

$\Large P=\frac{TP}{TP+FP}$

$\Large R=\frac{TP}{TP+FN}$

常用的为查准率和召回率的调和平均$F_1$得分。

$\Large F_1=\frac{2\times P\times R}{P+R}$

$F_1$为查准率和召回率的调和平均。$\frac{1}{F_1}=\frac{1}{2}\cdot(\frac{1}{P}+\frac{1}{R})$

#### P-R曲线

y轴为查准率，x轴为查全率。将所有结果按照预测概率从高到底排序，将正例的的阈值为第一个值（即最高值），得到一组当前查准率和查全率，将正例的阈值设为第二个值，得到一组查准率和查全率。。。。依次向下到把所有数据都分为正例，将所有查准率和查全率坐标连起来，即为P-R曲线。


```flow
st=>start: 开始
op1=>operation: 对结果按照预测概率从高到低排序
op2=>operation: 从高到低开始取值作为阈值
op3=>operation: 计算当前查准率和查全率
cond=>condition: 是否结束
e=>end: 将所有的查准率和查全率连起来

st->op1->op2->op3->cond
cond(yes)->e
cond(no)->op3

```

#### 多分类

当多个二分类时，评价模型性能好坏，一种简单的做法是分别计算各个混淆矩阵查准率和查全率，再计算平均值。

宏查准率：

$\Large macro-P=\frac{1}{n}\sum_{i=1}^{n}P_i$

宏查全率：

$\Large macro-R=\frac{1}{n}\sum_{i=1}^{n}R_i$

宏$F_1$：

$\Large macro-F_1=\frac{2\times macro-P\times macor_R}{macre-P+macro-R}$

还可以先将混淆矩阵对应元素进行平均，得到TP、FP、TN、FN的平均值$\TP$。基于这些平均值进行计算$F_1$

微查准率：

$\Large micro-P=\frac{\overline {TP}}{\overline{TP}+\overline{FP}}$

微查全率：

$\Large micro-R=\frac{\overline{TP}}{\overline{TP}+\overline{FN}}$

微$F_1$：

$\Large micro-F_1=\frac{2\times micaro-P\times micor-R}{micro-P+micro-R}$

#### 加权多分类

上面的多分类做平均时对每个分类都赋予相同权重。当针对实际情况时，可能需要对几个二分类模型的结果进行加权平均。

如当进行数据不均衡的分类任务时，为了识别出数量少的类别，可以使权重为$w=\frac{1}{log_2 n}$ ，n为每个类别的数目，通过这种方式对数目少的类别调高权重。